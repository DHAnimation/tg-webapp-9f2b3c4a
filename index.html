<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Оплата номерка</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex,nofollow" />

  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      margin: 0;
      padding: 16px;
      background: #f3f3f3;
    }

    .card {
      max-width: 480px;
      margin: 0 auto;
      background: #fff;
      border-radius: 12px;
      padding: 16px 16px 20px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
    }

    h2 {
      margin: 0 0 12px;
      font-size: 20px;
      font-weight: 700;
    }

    .warning {
      margin: 0 0 16px;
      padding: 10px 12px;
      border-radius: 8px;
      background: #fff4cf;
      border: 1px solid #f5d96b;
      font-size: 13px;
      line-height: 1.4;
    }

    .warning b {
      font-weight: 700;
    }

    .field {
      margin-bottom: 12px;
      font-size: 14px;
    }

    .field-label {
      margin-bottom: 4px;
      font-weight: 600;
    }

    .field-box {
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #ddd;
      background: #fafafa;
      min-height: 30px;
      font-size: 14px;
      white-space: pre-line;
    }

    input {
      width: 100%;
      padding: 9px 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 14px;
      box-sizing: border-box;
    }

    .hint {
      margin-top: 4px;
      color: #777;
      font-size: 12px;
    }

    .btn-row {
      margin-top: 16px;
    }

    button {
      width: 100%;
      padding: 11px 10px;
      border-radius: 10px;
      border: none;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      background: #4caf50;
      color: #fff;
    }

    button:disabled {
      opacity: 0.6;
      cursor: default;
    }

    .checkbox-row {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-top: 12px;
      font-size: 14px;
    }

    .checkbox-row input {
      width: auto;
    }
  </style>
</head>
<body>
  <div class="card">
    <h2 id="title">Игра #?, номерок #?</h2>

    <div class="warning">
      <b>ВНИМАНИЕ!</b> Вводите сумму и свои данные внимательно и без ошибок.
      Перед подтверждением ещё раз всё проверьте.
    </div>

    <div class="field">
      <div class="field-label">Сумма к переводу</div>
      <div class="field-box" id="amount-box">? ₽</div>
    </div>

    <div class="field">
      <div class="field-label">Реквизиты получателя</div>
      <div class="field-box" id="details-box">
Банк:
Получатель:
Номер:
      </div>
    </div>

    <div class="field">
      <div class="field-label">Ваши ФИО (как в банке)</div>
      <input id="fio-input" type="text" placeholder="Иванов Иван Иванович" />
      <div class="hint">
        Чтобы администратор быстро нашёл и подтвердил ваш платёж.
      </div>
    </div>

    <div class="checkbox-row">
      <input type="checkbox" id="paid-checkbox" />
      <label for="paid-checkbox">✅ Я оплатил</label>
    </div>

    <div class="btn-row">
      <button id="submit-btn" disabled>Отправить заявку</button>
    </div>
  </div>

  <script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    // формат start_param:
    // game_id:slot:price:bank|name|phone  (всё URL-кодировано)
    const rawParam = decodeURIComponent(tg.initDataUnsafe?.start_param || "");
    let gameId = null;
    let slot = null;
    let price = null;
    let bank = "";
    let payName = "";
    let payPhone = "";

    if (rawParam) {
      const parts = rawParam.split(":");

      if (parts.length >= 3) {
        const g = parseInt(parts[0]);
        const s = parseInt(parts[1]);
        const p = parseInt(parts[2]);

        gameId = Number.isNaN(g) ? null : g;
        slot   = Number.isNaN(s) ? null : s;
        price  = Number.isNaN(p) ? null : p;
      }

      if (parts.length >= 4) {
        const rest = parts.slice(3).join(":");
        const [b, n, ph] = rest.split("|");
        bank = b || "";
        payName = n || "";
        payPhone = ph || "";
      }
    }

    // подставляем текст
    const titleEl = document.getElementById("title");
    if (gameId && slot) {
      titleEl.textContent = `Игра #${gameId}, номерок #${slot}`;
    }

    const amountEl = document.getElementById("amount-box");
    if (price) {
      amountEl.textContent = `${price} ₽`;
    }

    const detailsEl = document.getElementById("details-box");
    detailsEl.textContent =
`Банк: ${bank || "—"}
Получатель: ${payName || "—"}
Номер: ${payPhone || "—"}`;

    // логика формы
    const fioInput = document.getElementById("fio-input");
    const paidCheckbox = document.getElementById("paid-checkbox");
    const submitBtn = document.getElementById("submit-btn");

    function updateButtonState() {
      const fioOk = fioInput.value.trim().length >= 3;
      submitBtn.disabled = !(fioOk && paidCheckbox.checked);
    }

    fioInput.addEventListener("input", updateButtonState);
    paidCheckbox.addEventListener("change", updateButtonState);

    submitBtn.addEventListener("click", () => {
      const fio = fioInput.value.trim();
      if (!fio) {
        tg.showAlert("Введите ФИО.");
        return;
      }
      if (!paidCheckbox.checked) {
        tg.showAlert("Поставьте галочку «Я оплатил».");
        return;
      }
      if (!gameId || !slot) {
        tg.showAlert("Ошибка данных игры. Попробуйте ещё раз.");
        return;
      }

      const payload = {
        game_id: gameId,
        slot: slot,
        fio: fio,
      };

      // Тут как раз то самое сообщение, которое ты хотел
      tg.showAlert(
        "Ваш номерок забронирован.\n" +
        "После подтверждения администратором он в списке станет ❌ и будет недоступен другим."
      );

      tg.sendData(JSON.stringify(payload));
      tg.close();
    });
  </script>
</body>
</html>
